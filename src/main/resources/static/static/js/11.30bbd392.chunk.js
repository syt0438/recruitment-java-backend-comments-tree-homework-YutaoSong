(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{668:function(e,t,a){},702:function(e,t,a){"use strict";a.r(t);a(654);var n,r=a(681),s=a.n(r),l=(a(658),a(687)),i=a.n(l),c=(a(660),a(686)),o=a.n(c),u=(a(430),a(432)),p=a.n(u),d=(a(662),a(680)),m=a.n(d),g=(a(464),a(465)),h=a.n(g),f=a(697),y=(a(173),a(41)),v=a.n(y),E=a(19),b=a.n(E),C=a(35),w=(a(665),a(679)),x=a.n(w),M=a(51),k=a(52),S=a(55),I=a(53),R=a(54),j=(a(423),a(424)),O=a.n(j),N=a(0),A=a.n(N),T=a(108),z=a(59),B=a.n(z),U=a(110),L=(a(668),O.a.TextArea);function D(e){return{__html:e}}var H=Object(U.b)(function(e){return{user:e.user}})(n=function(e){function t(){var e,a;Object(M.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(S.a)(this,(e=Object(I.a)(t)).call.apply(e,[this].concat(r)))).state={messages:[],isShowEditor:!1,parentId:"",replyContent:"",replyUser:null,expandIds:[],placeholder:"",loading:!1},a.handleMessageChange=function(e){a.setState({publishMessage:e.target.value});var t=200-e.target.value.length;t=t>=0?t:0,x.a.open({key:"publishMsg",message:"\u60a8\u5f53\u524d\u8fd8\u53ef\u4ee5\u8f93\u5165"+t+"\u4e2a\u5b57"})},a.handleReplyChange=function(e){a.setState({replyContent:e.target.value});var t=200-e.target.value.length;t=t>=0?t:0,x.a.open({key:"replyMsg",message:"\u60a8\u5f53\u524d\u8fd8\u53ef\u4ee5\u8f93\u5165"+t+"\u4e2a\u5b57"})},a.clearContent=function(){a.setState({publishMessage:""})},a.closeMessage=function(){a.setState({isShowEditor:!1}),a.clearContent()},a.getMessages=Object(C.a)(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loading:!0}),e.next=3,Object(T.a)("/message/list",null);case 3:if(0===(t=e.sent).code){e.next=7;break}return a.setState({loading:!1}),e.abrupt("return");case 7:a.setState({messages:t.data||[],loading:!1});case 8:case"end":return e.stop()}},e)})),a.sendMessage=Object(C.a)(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state.publishMessage){e.next=4;break}return v.a.warning("\u8bf7\u5148\u8f93\u5165\u5185\u5bb9"),e.abrupt("return");case 4:return e.next=6,Object(T.d)("/message",{msg:t});case 6:0===e.sent.code&&(v.a.success("\u7559\u8a00\u6210\u529f"),a.clearContent(),a.getMessages());case 8:case"end":return e.stop()}},e)})),a.showReply=function(e,t){a.setState({parentId:t,replyContent:"",replyUser:e,placeholder:"".concat(a.props.user.uid," @ ").concat(e.uid)})},a.closeReply=function(){a.setState({parentId:"",replyContent:"",replyUser:"",placeholder:""})},a.closeReplyNotification=function(){x.a.close("replyMsg")},a.closePublishNotification=function(){x.a.close("publishMsg")},a.confirmReply=function(){var e=Object(C.a)(b.a.mark(function e(t){var n,r;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state.replyContent){e.next=4;break}return v.a.warning("\u8bf7\u8f93\u5165\u56de\u590d\u5185\u5bb9"),e.abrupt("return");case 4:return r={msg:n,messageId:t.messageId||t.id,parentId:a.state.replyUser.id},e.next=7,Object(T.d)("/comment",r);case 7:0===e.sent.code&&(v.a.success("\u56de\u590d\u6210\u529f"),a.closeReply(),a.getMessages(),a.state.expandIds.includes(t.id)||a.setState({expandIds:[].concat(Object(f.a)(a.state.expandIds),[t.id])}));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.renderTree=function(e){return e.map(function(e){var t=a.state,n=t.parentId,r=t.replyContent,s=(t.expandIds,t.placeholder);t.loading;if(e.children)return A.a.createElement(m.a,{key:e.id,author:A.a.createElement("span",{style:{fontSize:15}},e.uid," @ ",e.parentUid),avatar:A.a.createElement("img",{className:"avatar-img-small",src:"http://localhost:8080/images/default.png",alt:"avatar"}),content:A.a.createElement("div",{className:"info-box",dangerouslySetInnerHTML:D(e.msg)}),actions:a.renderActions(e,e.id)},a.renderTree(e.children),n===e.id&&A.a.createElement("div",{style:{width:"70%",textAlign:"right"}},A.a.createElement(L,{rows:4,style:{marginBottom:10},value:r,onChange:a.handleReplyChange,placeholder:s,maxLength:200,onBlur:a.closeReplyNotification}),A.a.createElement(h.a,{size:"small",onClick:a.closeReply},"\u53d6\u6d88"),"\u2003",A.a.createElement(h.a,{size:"small",type:"primary",onClick:function(){return a.confirmReply(e)}},"\u56de\u590d")))})},a.renderActions=function(e,t){return[A.a.createElement("span",null,A.a.createElement(p.a,{title:"\u56de\u590d\u65f6\u95f4"},B()(e.createTime).format("YYYY-MM-DD HH:mm:ss"))),A.a.createElement("span",{style:Y.actionItem},A.a.createElement(p.a,{title:"\u56de\u590d"},A.a.createElement("span",{onClick:function(){return a.showReply(e,t)}},A.a.createElement("span",{className:"iconfont icon-commentoutline my-iconfont"}),"\xa0\u56de\u590d")))]},a}return Object(R.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){this.getMessages()}},{key:"componentDidUpdate",value:function(e){if(this.props.user!==e.user){var t=this.state.pagination,a=t.current,n=t.pageSize;this.getMessages(a,n)}}},{key:"render",value:function(){var e=this,t=this.state,a=t.isShowEditor,n=t.messages,r=t.parentId,l=t.replyContent,c=t.publishMessage,u=(t.expandIds,t.placeholder),p=t.loading;return A.a.createElement("div",{style:{padding:24}},A.a.createElement(s.a,{bordered:!1,bodyStyle:{paddingTop:0}},A.a.createElement("div",null,a?A.a.createElement("div",{style:{marginTop:10}},A.a.createElement(L,{rows:4,style:{marginBottom:10},value:c,onChange:this.handleMessageChange,placeholder:"",maxLength:200,onBlur:this.closePublishNotification}),A.a.createElement(h.a,{type:"primary",onClick:this.sendMessage},"\u53d1\u8868"),"\u2003",A.a.createElement(h.a,{onClick:this.closeMessage},"\u53d6\u6d88")):A.a.createElement(h.a,{onClick:function(){return e.setState({isShowEditor:!0})}},"\u6211\u8981\u7559\u8a00")),A.a.createElement(o.a,null),A.a.createElement(i.a,{spinning:p,style:{position:"fixed",top:"50%",left:"50%"}}),A.a.createElement("div",{className:"message-list-box"},Array.isArray(n)&&n.map(function(t,a){return A.a.createElement(m.a,{key:t.id,author:A.a.createElement("span",{style:{fontSize:16}},t.uid),avatar:A.a.createElement("img",{className:"avatar-img",src:"http://localhost:8080/images/default.png",alt:"avatar"}),content:A.a.createElement("div",{className:"info-box braft-output-content",dangerouslySetInnerHTML:D(t.msg)}),actions:e.renderActions(t,t.id),datetime:"\u7b2c".concat(n.length-a,"\u697c")},e.renderTree(t.children),r===t.id&&A.a.createElement("div",{style:{width:"70%",textAlign:"right"}},A.a.createElement(L,{rows:4,style:{marginBottom:10},value:l,onChange:e.handleReplyChange,placeholder:u,maxLength:200,onBlur:e.closeReplyNotification}),A.a.createElement(h.a,{size:"small",onClick:e.closeReply},"\u53d6\u6d88"),"\u2003",A.a.createElement(h.a,{size:"small",type:"primary",onClick:function(){return e.confirmReply(t)}},"\u56de\u590d")))}))))}}]),t}(N.Component))||n,Y={actionItem:{fontSize:14}};t.default=H}}]);